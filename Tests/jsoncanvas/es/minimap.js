import{g as i,b as t,c as e,a,d as n}from"../utilities-9mYNj6lG.js";class s{constructor(n,s){this.toggleCollapse=()=>{this.minimapCollapsed=!this.minimapCollapsed,this.minimapContainer.classList.toggle("collapsed"),this.minimapCollapsed||this.updateViewportRectangle()},this.drawMinimap=()=>{const i=this.data.nodeBounds;if(!i)return;const t=this.minimap.clientWidth,e=this.minimap.clientHeight,a=t/i.width,n=e/i.height;this.minimapCache.scale=.9*Math.min(a,n),this.minimapCache.centerX=t/2,this.minimapCache.centerY=e/2,this.minimapCtx.clearRect(0,0,t,e),this.minimapCtx.save(),this.minimapCtx.translate(this.minimapCache.centerX,this.minimapCache.centerY),this.minimapCtx.scale(this.minimapCache.scale,this.minimapCache.scale),this.minimapCtx.translate(-i.centerX,-i.centerY);for(const i of this.data.canvasData.edges)this.drawMinimapEdge(i);for(const i of this.data.canvasData.nodes)this.drawMinimapNode(i);this.minimapCtx.restore()},this.drawMinimapNode=e=>{const a=i(e.color);this.minimapCtx.fillStyle=a.border,this.minimapCtx.globalAlpha=.3,t(this.minimapCtx,e.x,e.y,e.width,e.height,25),this.minimapCtx.fill(),this.minimapCtx.globalAlpha=1},this.drawMinimapEdge=i=>{const t=this.data.nodeMap[i.fromNode],a=this.data.nodeMap[i.toNode];if(!t||!a)return;const[n,s]=e(t,i.fromSide),[m,h]=e(a,i.toSide);this.minimapCtx.beginPath(),this.minimapCtx.moveTo(n,s),this.minimapCtx.lineTo(m,h),this.minimapCtx.strokeStyle="#555",this.minimapCtx.lineWidth=10,this.minimapCtx.stroke()},this.updateViewportRectangle=()=>{if(this.minimapCollapsed)return;const i=this.data.nodeBounds;if(!i)return;const t=this.data.container.clientWidth/this.data.scale,e=this.data.container.clientHeight/this.data.scale,a=-this.data.offsetX/this.data.scale+this.data.container.clientWidth/(2*this.data.scale),n=-this.data.offsetY/this.data.scale+this.data.container.clientHeight/(2*this.data.scale),s=this.minimapCache.centerX+(a-t/2-i.centerX)*this.minimapCache.scale,m=this.minimapCache.centerY+(n-e/2-i.centerY)*this.minimapCache.scale,h=t*this.minimapCache.scale,l=e*this.minimapCache.scale;this.viewportRectangle.style.left=s+"px",this.viewportRectangle.style.top=m+"px",this.viewportRectangle.style.width=h+"px",this.viewportRectangle.style.height=l+"px"},this.dispose=()=>{this.toggleMinimapBtn.removeEventListener("click",this.toggleCollapse),this.minimapCtx.clearRect(0,0,this.minimap.clientWidth,this.minimap.clientHeight),this.minimapContainer.remove(),this._minimapContainer=null,this._toggleMinimapBtn=null,this._viewportRectangle=null,this._minimap=null},s.register({hooks:{onLoad:[this.drawMinimap],onRender:[this.updateViewportRectangle],onDispose:[this.dispose]},options:{minimap:{collapsed:!1}},api:{minimap:{toggleCollapse:this.toggleCollapse}}}),this._minimapContainer=document.createElement("div"),this._minimapContainer.className="minimap-container",this._toggleMinimapBtn=document.createElement("button"),this._toggleMinimapBtn.className="toggle-minimap collapse-button",this._toggleMinimapBtn.innerHTML='<svg viewBox="-3.6 -3.6 31.2 31.2" stroke-width=".4"><path d="M15.707 4.293a1 1 0 0 1 0 1.414L9.414 12l6.293 6.293a1 1 0 0 1-1.414 1.414l-7-7a1 1 0 0 1 0-1.414l7-7a1 1 0 0 1 1.414 0Z" /></svg>',this._minimapContainer.appendChild(this._toggleMinimapBtn),this._minimap=document.createElement("div"),this._minimap.className="minimap";const m=document.createElement("canvas");m.className="minimap-canvas",m.width=200,m.height=150,this._minimap.appendChild(m),this.minimapCtx=m.getContext("2d"),this._viewportRectangle=document.createElement("div"),this._viewportRectangle.className="viewport-rectangle",this._minimap.appendChild(this._viewportRectangle),this._minimapContainer.appendChild(this._minimap),n.container.appendChild(this._minimapContainer),this.data=n,this.minimapCollapsed=s.options.minimap.collapsed,this._minimapContainer.classList.toggle("collapsed",this.minimapCollapsed),this.minimapCache={scale:1,centerX:0,centerY:0},this._toggleMinimapBtn.addEventListener("click",this.toggleCollapse),a(m,m.width,m.height)}get minimap(){if(null===this._minimap)throw n;return this._minimap}get viewportRectangle(){if(null===this._viewportRectangle)throw n;return this._viewportRectangle}get minimapContainer(){if(null===this._minimapContainer)throw n;return this._minimapContainer}get toggleMinimapBtn(){if(null===this._toggleMinimapBtn)throw n;return this._toggleMinimapBtn}}export{s as default};
